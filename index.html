<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>国土交通省 重要なお知らせ（RSS対応・文字化け対策）</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { font-family: Arial, sans-serif; background: #f9f9f9; color: #333; margin:0; padding:20px; }
  h1 { text-align:center; color:#004080; margin-bottom:20px; }
  #rss-feed { max-width:800px; margin:0 auto; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
  .rss-item { border-bottom:1px solid #ddd; padding:10px 0; }
  .rss-item:last-child { border-bottom:none; }
  .rss-item a { text-decoration:none; color:#0066cc; font-weight:bold; }
  .rss-item a:hover { text-decoration:underline; }
  .rss-date { display:block; font-size:0.9em; color:#666; margin-top:4px; }
  #status { text-align:center; color:#666; margin-bottom:10px; }
  .error { color:#b91c1c; }
</style>
</head>
<body>
<h1>国土交通省 重要なお知らせ</h1>
<div id="status">読み込み中...</div>
<div id="rss-feed"></div>

<script>
(async function() {
  const url = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('http://www.mlit.go.jp/important.rdf');
  const container = document.getElementById('rss-feed');
  const statusEl = document.getElementById('status');

  function setStatus(msg, isError=false) {
    statusEl.textContent = msg;
    statusEl.className = isError ? 'error' : '';
  }

  function formatDate(dateStr) {
    const d = new Date(dateStr);
    if (isNaN(d)) return '';
    return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;
  }

  try {
    const response = await fetch(url);
    const buffer = await response.arrayBuffer();

    // 複数エンコーディング候補を試す
    const encodings = ['shift_jis', 'euc-jp', 'iso-2022-jp', 'utf-8'];
    let text = '';
    for (const enc of encodings) {
      try {
        text = new TextDecoder(enc).decode(buffer);
        if (text.includes('国土交通省') || text.includes('<title>')) break;
      } catch(e) { continue; }
    }

    const parser = new DOMParser();
    const xml = parser.parseFromString(text, 'application/xml');
    const items = Array.from(xml.getElementsByTagName('item')).map(item => {
      const title = item.getElementsByTagName('title')[0]?.textContent.trim() || '';
      const link = item.getElementsByTagName('link')[0]?.textContent.trim() || '';
      const date = item.getElementsByTagName('dc:date')[0]?.textContent.trim() || '';
      return { title, link, date };
    }).filter(i => i.title && i.link);

    if (items.length === 0) {
      setStatus('RSSのデータが見つかりませんでした。', true);
      return;
    }

    // 日付降順で並べ替え
    items.sort((a,b) => new Date(b.date||0) - new Date(a.date||0));

    container.innerHTML = items.slice(0,10).map(i => `
      <div class="rss-item">
        ${i.link}${i.title}</a>
        <span class="rss-date">${formatDate(i.date)}</span>
      </div>
    `).join('');

    setStatus(''); // ステータス非表示
  } catch (error) {
    console.error(error);
    setStatus('RSSの読み込みに失敗しました。', true);
  }
})();
</script>
</body>
</html>
