<script>
(async function() {
  const url = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('http://www.mlit.go.jp/important.rdf');
  const container = document.getElementById('rss-feed');

  try {
    const response = await fetch(url);
    const buffer = await response.arrayBuffer();

    // 複数のエンコーディング候補を試す
    const encodings = ['shift_jis', 'euc-jp', 'iso-2022-jp', 'utf-8'];
    let text = '';
    for (const enc of encodings) {
      try {
        text = new TextDecoder(enc).decode(buffer);
        if (text.includes('国土交通省') || text.includes('<title>')) break;
      } catch(e) { continue; }
    }

    const parser = new DOMParser();
    const xml = parser.parseFromString(text, 'application/xml');

    const items = Array.from(xml.getElementsByTagName('item')).map(item => {
      const title = item.getElementsByTagName('title')[0]?.textContent || '';
      const link = item.getElementsByTagName('link')[0]?.textContent || '';
      const date = item.getElementsByTagName('dc:date')[0]?.textContent || '';
      return { title, link, date };
    });

    if (items.length === 0) {
      container.innerHTML = '<p>RSSのデータが見つかりませんでした。</p>';
      return;
    }

    container.innerHTML = items.slice(0, 5).map(i => `
      <div class="rss-item">
        ${i.link}${i.title}</a>
        <span class="rss-date">${i.date ? new Date(i.date).toLocaleDateString('ja-JP') : ''}</span>
      </div>
    `).join('');

  } catch (error) {
    container.innerText = 'RSSの読み込みに失敗しました。';
    console.error(error);
  }
})();
</script>
